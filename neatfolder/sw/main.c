/******************************************************************
 * This is the main file for the Software Sessions
 *
 */

#include <stdint.h>
#include <inttypes.h>
//#include "warmup.c"
#include "common.h"

// Uncomment for Session SW1
//extern void warmup();

// Uncomment for Session SW2 onwards
#include "mp_arith.h"
#include "montgomeryOpt.h"
#include "montgomery.h"
#include "asm_func.h"


void customprint(uint32_t *in, char *str, uint32_t size);


int main()
{
	xil_printf("test");
    init_platform();
    init_performance_counters(1);

    // Hello World template
    //----------------------
    xil_printf("Begin\n\r");


    // Multiprecision add

/*
    START_TIMING
common
    uint32_t a[32]   = { 0xe87c0891, 0xedefbacf, 0xbe75c544, 0xb29e5e19, 0x860c5ab6, 0xf1e491df, 0xc8d459fe, 0xc811c225, 0xc4870bec, 0x60af8542, 0xec8422a1, 0xa5d7ac12, 0x5e3ad006, 0xc99e51d9, 0xfb0db87f, 0xbf7d0d0c, 0x51777580, 0x77f88d79, 0x7437df95, 0x96787032, 0x38cfc8ca, 0xba87a2b5, 0x1de9b64c, 0x56905a55, 0xdf056077, 0x02edd0b8, 0x3a8af36b, 0x631da6cb, 0xde2f29a8, 0x3982f519, 0xb51e533c, 0xcabe8494 };
    uint32_t b[32]   = { 0x40ea3679, 0x13b7e95f, 0x961bf864, 0xd09d0a0a, 0x72ed6a7b, 0x2ac4de5b, 0x8b9ebd95, 0xcf2cdf20, 0x9b729071, 0x39e2ff0a, 0x8f04fa45, 0x9b16fe5a, 0x79366180, 0xff9d8257, 0x1060d96f, 0x3de121ba, 0xb30033c8, 0xaf5943cd, 0x65703523, 0xb2630421, 0x6d0e6319, 0xc99c9aa4, 0x45e02225, 0xac1523c7, 0x50471970, 0xd4cddec8, 0x7489978a, 0xa698959d, 0x4230dc65, 0xba17abc1, 0x15b5dc9b, 0xaca3a8e7 };
    uint32_t res[33];
    mp_add(a, b, res, 32);



    STOP_TIMINGhttps://
docs.google.com/spreadsheets/d/1HfGPprBZ7Aqqg8PrKkG2
-
KHsRAj2xVkyLIlpmbjNhh8
	customprint(res, "Resultaat", 33);
    //Multiprecivoid customprint(uint32_t *in, char *str, uint32_t size)sion subtract

START_TIMING

uint32_t a1[32]   = { 0xe87c0891, 0xedefbacf, 0xbe75c544, 0xb29e5e19, 0x860c5ab6, 0xf1e491df, 0xc8d459fe, 0xc811c225, 0xc4870bec, 0x60af8542, 0xec8422a1, 0xa5d7ac12, 0x5e3ad006, 0xc99e51d9, 0xfb0db87f, 0xbf7d0d0c, 0x51777580, 0x77f88d79, 0x7437df95, 0x96787032, 0x38cfc8ca, 0xba87a2b5, 0x1de9b64c, 0x56905a55, 0xdf056077, 0x02edd0b8, 0x3a8af36b, 0x631da6cb, 0xde2f29a8, 0x3982f519, 0xb51e533c, 0xcabe8494 };
uint32_t b1[32]   = { 0x40ea3679, 0x13b7e95f, 0x961bf864, 0xd09d0a0a, 0x72ed6a7b, 0x2ac4de5b, 0x8b9ebd95, 0xcf2cdf20, 0x9b729071, 0x39e2ff0a, 0x8f04fa45, 0x9b16fe5a, 0x79366180, 0xff9d8257, 0x1060d96f, 0x3de121ba, 0xb30033c8, 0xaf5943cd, 0x65703523, 0xb2630421, 0x6d0e6319, 0xc99c9aa4, 0x45e02225, 0xac1523c7, 0x50471970, 0xd4cddec8, 0x7489978a, 0xa698959d, 0x4230dc65, 0xba17abc1, 0x15b5dc9b, 0x9651d473 };


uint32_t res1[32];
	mp_sub(a1, b1, res1, 32);



STOP_TIMING
customprint(res1, "Resultaat", 32);
	xil_printf("\r\n");

//Modulo addition

START_TIMING

uint32_t a2[32] void customprint(uint32_t *in, char *str, uint32_t size)  = { 0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315, 0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9, 0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee, 0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107, 0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a, 0x44eef089, 0x81bf5831 };
uint32_t b2[32]   = { 0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808, 0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2, 0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6, 0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145, 0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1, 0x94f2db82, 0x80deb209 };
uint32_t n2[32]   = { 0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8, 0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0, 0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4, 0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391, 0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e, 0x9a09328e, 0x82260dd0 };

uint32_t res2[32];
	mod_add(a2, b2, n2, res2, 32);



STOP_TIMING
customprint(res2, "Resultaat", 32);
xil_printf("\r\n");

    START_TIMING

    //Modulo subtract
    uint32_t a3[32]   = { 0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315, 0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9, 0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee, 0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107, 0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a, 0x44eef089, 0x81bf5831 };
    uint32_t b3[32]   = { 0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808, 0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2, 0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6, 0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145, 0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1, 0x94f2db82, 0x80deb209 };
    uint32_t n3[32]   = { 0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8, 0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0, 0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4, 0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391, 0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e, 0x9a09328e, 0x82260dd0 };


    uint32_t res3[32];
    	mod_sub(a3, b3, n3, res3, 32);

    STOP_TIMING
    customprint(res3, "Resultaat", 32);
    xil_printf("\r\n");

*/




//    uint32_t a[32]         = { 0x0ffd20fc, 0x336877a8, 0x9107eaa3, 0xf6e856eb, 0x2eb66e22, 0xd9ffccd6, 0x4677eeb2, 0xd5250874, 0x36a34e80, 0x817676ee, 0xb7a8138e, 0xb40ff20a, 0x52e9c7b4, 0x4eacd691, 0x077c3dad, 0xf1d47508, 0x929d358c, 0xa88e28e3, 0xf15f60d8, 0xfa983af6, 0xd6729b02, 0x9389f3f8, 0x45659c72, 0x675e04e8, 0x73ef6524, 0x25e6d92a, 0x975a5eec, 0x17b9d0d0, 0x5d64b615, 0x5f225143, 0x099235c0, 0x80d60b17 };
//    uint32_t b[32]         = { 0x00000005, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0000fff0, 0x00000000, 0x00000003 };
//    uint32_t n[32]         = { 0xffffffff, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000 };
//    uint32_t n_prime[32]   = { 0x00000001, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000 };
//    uint32_t a[32]         = { 0x0ffd20fc, 0x336877a8, 0x9107eaa3, 0xf6e856eb, 0x2eb66e22, 0xd9ffccd6, 0x4677eeb2, 0xd5250874, 0x36a34e80, 0x817676ee, 0xb7a8138e, 0xb40ff20a, 0x52e9c7b4, 0x4eacd691, 0x077c3dad, 0xf1d47508, 0x929d358c, 0xa88e28e3, 0xf15f60d8, 0xfa983af6, 0xd6729b02, 0x9389f3f8, 0x45659c72, 0x675e04e8, 0x73ef6524, 0x25e6d92a, 0x975a5eec, 0x17b9d0d0, 0x5d64b615, 0x5f225143, 0x099235c0, 0x80d60b17 };
//    uint32_t b[32]         = { 0xe915fb8b, 0x80994bcf, 0xf793d789, 0x18e8eff3, 0xc3e472e9, 0x6766ae05, 0x00e4f68b, 0x533e039b, 0xa924fd10, 0xced0727f, 0xbc27114f, 0xb0bece60, 0x6f7bf509, 0x05eeaddc, 0xbb861fc9, 0x4dbf5629, 0x4cb153ec, 0xc19c3150, 0x97764d2e, 0x510d7467, 0xdb0ed4cc, 0xa25c8f33, 0x93ae30f6, 0xf3c6970f, 0xd4ae423b, 0xc7d9c310, 0x099c1fd1, 0x9cced66a, 0xfa791df9, 0xe15e3187, 0x145d43b9, 0x8da528c5 };
//    uint32_t n[32]         = { 0xac6452f1, 0xfb798942, 0x0f249901, 0x5babf628, 0x7b289988, 0x9b0be47a, 0x20a8c13d, 0x30edb1b2, 0x32df5d0d, 0x2c6ac4f1, 0x61f43828, 0x5ee58557, 0x1b61dc4c, 0x772a3783, 0xb782a039, 0x1226f07d, 0x90961184, 0x3b53e965, 0x932d242f, 0x1201ed0c, 0x5ecb0bc7, 0x1ce6ab19, 0xad318f92, 0x24f30dab, 0x572370a9, 0x4861dc4f, 0xca484f1a, 0x478d60b2, 0xba834df4, 0xfa48b670, 0x854edbd8, 0xa763d5e7 };
//    uint32_t n_prime[32]   = { 0xdefda1ef, 0x7c5ffb73, 0xd5a6f809, 0x0f812315, 0x2a693b12, 0xc54a47b1, 0x6e816600, 0x97551771, 0xe851f7f4, 0x739b5800, 0xa385125c, 0x5bbf7193, 0xa6e8cf36, 0x1adcf8e3, 0x8f9981f8, 0x1a833f93, 0x22d26149, 0xcc8db2fd, 0x61f127ef, 0x0c70cb1e, 0x21c009e5, 0x70cd184e, 0xb1d43815, 0x14bedb8b, 0x6d3f7b9c, 0x3624f511, 0x59c51283, 0x65352aed, 0x7b0d1201, 0x65ab7c87, 0x6b99003b, 0x6f11bf30 };
//    uint32_t a[32]         = { 0x5c7653d7, 0x0067e5c3, 0x9cf9358d, 0xe9ed032e, 0xb2c76d54, 0x4bab8457, 0x786a80af, 0x84296a20, 0xcef6a7a5, 0x00b42b31, 0xdfae7582, 0xfba8bb67, 0xc5a4792e, 0x0236548a, 0x07ffeff2, 0xd5e1252c, 0x06bfa5c7, 0x9a3a4f3d, 0x527ae169, 0x41ce3d21, 0xaa84918c, 0x05d6a549, 0x97fdf3e2, 0xc58cfc11, 0x39934953, 0x3761f954, 0x3f5f3fd0, 0xcba4c68e, 0x74d06c4f, 0xa19f7439, 0x1a7519ff, 0xac2964bf };
//    uint32_t b[32]         = { 0x819da1b8, 0x4235ff00, 0x712e10ba, 0xbcdfc65b, 0x63eaca75, 0xd8afd026, 0xacc9d209, 0x7e412044, 0x38e1b1cb, 0x013642c8, 0x6be1f1f9, 0x8922c3eb, 0x567213f7, 0x093ebb60, 0x51b13be6, 0xbd1f4a29, 0xef8b7928, 0x42a3c411, 0xc48d9582, 0xb47450f8, 0x2bf14286, 0xf82d9abc, 0xb4e76a10, 0x63d1f360, 0x27776cd2, 0x3178ccef, 0xb51864fd, 0x6860be5c, 0x10793091, 0x431e5193, 0x74af3c87, 0xb3a50efc };
//    uint32_t n[32]         = { 0x5475ed99, 0xdd171789, 0x2ce4ff7e, 0xeaf25a22, 0x5028c484, 0xc1f82829, 0xa34a82ca, 0xbd3f4b53, 0x12c33f19, 0xa1b7fbe1, 0x50d25213, 0xa911556e, 0x1256fe3b, 0x70672c29, 0x962f3e93, 0xc745a57b, 0x366ea175, 0x7cda38fa, 0xca2af608, 0xed424c27, 0xfc56f899, 0x185f17a7, 0xb27ea851, 0xdad6e6d0, 0x5c7b4a5e, 0x172a6f89, 0xcc713ae5, 0x8f06ddfe, 0x6ea70899, 0xf3d4b00a, 0xa33e222e, 0xb3cf31f2 };
//    uint32_t n_prime[32]   = { 0x9f8ce957, 0xcfcdfbad, 0x13844dee, 0xe2ff46e7, 0xf5eb8ee7, 0x166160dd, 0x0d955352, 0x93838015, 0xfb58cf54, 0x405f0073, 0xf58955d9, 0xb0a773df, 0x4e3a4dcc, 0x7e02ad33, 0xada05787, 0x9e43b768, 0x14d2f06b, 0xc7510d41, 0x64415833, 0xe2a50fff, 0x8d458207, 0x85c8f984, 0xe4f62b23, 0xad51b547, 0xaa2c0c36, 0x637f3afe, 0xd06184e0, 0x0a799e8b, 0xe8597180, 0xe8fcb63b, 0xdcce9ab9, 0xf7abd770 };

    uint32_t a[32]         = { 0xa2e47eba, 0xdb5e3e7d, 0x5fd9a7cb, 0x9e7a37c3, 0x4dc37416, 0x834fe315, 0x0080dbac, 0x47280a4d, 0x722dc3dd, 0x7f0ca6f4, 0x7f0da3db, 0xfc20cbb9, 0xb749699e, 0xc5abc925, 0x8bc67669, 0x23a30d3f, 0xffe44e1c, 0xdb22d6ee, 0x5dc3d3b3, 0xfe7e980d, 0x894075d2, 0xdeabe7c4, 0x58042c3b, 0x1cc18107, 0xf0abb2e1, 0x7bd31dc0, 0x72355db9, 0xf55a0178, 0x99f5d831, 0x12ccb47a, 0x44eef089, 0x81bf5831 };
    uint32_t b[32]         = { 0xe47d092a, 0xd7615ed9, 0xa8aff661, 0xc3d7bb8c, 0x2d22b31c, 0x5050b808, 0xb0bc44bb, 0x93e46f4f, 0xac0332e5, 0x81ad7f85, 0x23de9197, 0x4b35f0a2, 0x6303744a, 0x615740bf, 0x54ebbaef, 0xf36273c2, 0xaf0d1080, 0x4740c9d6, 0x458e6699, 0xaaa1040b, 0x614df162, 0xaf7fe30d, 0xac73e3ed, 0x49204145, 0x1653523c, 0x5ee4f3b1, 0x2b3f4339, 0x5b9a2426, 0x62e3ffb3, 0xf4c32df1, 0x94f2db82, 0x80deb209 };
    uint32_t n[32]         = { 0xb2e52d11, 0x8f850a5f, 0x08edfb0c, 0x4f02a1ac, 0xdd070636, 0x6c59cfc8, 0x16a40db7, 0x85bba009, 0x598eba07, 0x5d0fa3cc, 0x32bc6fb5, 0x4aa27cd0, 0x0928454e, 0x027d3081, 0xd1caec35, 0xa98e4223, 0x533983de, 0x36370bb4, 0xe8b0b4c6, 0xfe3655ab, 0x27a4a51e, 0xb403c449, 0xa679cf3b, 0xc1fc4391, 0x884e5080, 0xa65d4d30, 0xcd90ed67, 0x55fcb457, 0x989d6f4c, 0x0303d70e, 0x9a09328e, 0x82260dd0 };
    uint32_t n_prime[32]   = { 0xfb5c9c0f, 0xd3cbec85, 0x3a126c50, 0x0f85259a, 0xb93b900a, 0x89feafbe, 0x30847469, 0x0a87f885, 0x9d5bfa86, 0xec1adae0, 0x448a3dac, 0xa7194e08, 0x61c37198, 0xd5eff8a8, 0xf96efef1, 0x473d83aa, 0xe7c048dd, 0xb1893377, 0xc843e910, 0xcd3b86d2, 0x2119b9dd, 0x6caed27a, 0x7ebcc873, 0x2019cd09, 0x240e3495, 0x040754fb, 0xdfef2830, 0x32a287d7, 0x8e79f7e4, 0x3daeb7e0, 0xbeaeac00, 0x376725cd };



 //	uint32_t res4[32]       = { 0xc1a79235, 0xd15bdcd9, 0x86dd5707, 0x6a6e2ed5, 0x78d65d5b, 0x67f68e70, 0x710272e2, 0x50a864f0, 0xe401fd13, 0xa6e5230a, 0xe4a75a02, 0xf7c33347, 0x94d157f4, 0x1bc14069, 0x9245536d, 0xb25744a2, 0xac45171d, 0x19c1b2c9, 0xd4d5c639, 0xe9e6d577, 0xaad70eb9, 0x3fa67458, 0xe1ada6a5, 0xb2d16fa6, 0x70eb264e, 0x9e7980a1, 0x180ae432, 0x0650546d, 0x32a11b91, 0x4fba59bd, 0x660f196e, 0x4bf569da };





	uint32_t res4[32];
	START_TIMING
	montMulOpt(a, b, n , n_prime, res4, 32);
	STOP_TIMING
	customprint(res4, "Resultaat Montgomery", 32);
	xil_printf("\n\r");
	xil_printf("End\n\r");

    // SW1: warmup exercise
    //----------------------
    //warmup();

    cleanup_platform();

    return 0;
}


void customprint(uint32_t *in, char *str, uint32_t size)	{
    int32_t i;

    xil_printf("0x");
    for (i = size-1; i >= 0 ; i--) {
    	xil_printf("%9x", in[i]);
    }
    xil_printf("\n\r");
}
